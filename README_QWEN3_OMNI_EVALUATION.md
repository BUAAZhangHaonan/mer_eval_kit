# Qwen3-Omni å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†æè¯„ä¼°å·¥å…·

è¿™æ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°Qwen3-Omniæ¨¡å‹åœ¨å¤šä¸ªæƒ…æ„Ÿåˆ†ææ•°æ®é›†ä¸Šæ€§èƒ½çš„å®Œæ•´å·¥å…·åŒ…ã€‚è¯¥å·¥å…·æ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘ç­‰å¤šç§æ¨¡æ€çš„æƒ…æ„Ÿåˆ†æä»»åŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **å¤šæ•°æ®é›†æ”¯æŒ**: æ”¯æŒ12ä¸ªä¸»æµæƒ…æ„Ÿåˆ†ææ•°æ®é›†
- ğŸ¯ **å¤šä»»åŠ¡ç±»å‹**: æ”¯æŒåˆ†ç±»ã€å›å½’å’Œå¤šæ¨¡æ€ä»»åŠ¡
- ğŸ“¹ **æ™ºèƒ½è§†é¢‘å¤„ç†**: è‡ªåŠ¨è§†é¢‘åˆ‡ç‰‡å’Œå¸§é‡‡æ ·
- ğŸŒ **vLLMå…¼å®¹**: é€šè¿‡OpenAIå…¼å®¹APIè°ƒç”¨vLLMæœåŠ¡
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š**: ç”Ÿæˆå®Œæ•´çš„è¯„ä¼°æŠ¥å‘Šå’Œæ€§èƒ½åˆ†æ
- âš™ï¸ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰æ ·æœ¬æ•°é‡å’Œè¯„ä¼°å‚æ•°

## æ”¯æŒçš„æ•°æ®é›†

### åˆ†ç±»ä»»åŠ¡ (6ä¸ª)
- **AffectNet_Classifier**: å›¾åƒæƒ…æ„Ÿåˆ†ç±»
- **AffWild2_EXPR**: è§†é¢‘è¡¨æƒ…åˆ†ç±»  
- **EmotionTalk**: å¯¹è¯æƒ…æ„Ÿåˆ†ç±»
- **MELD**: å¤šæ¨¡æ€å¯¹è¯æƒ…æ„Ÿåˆ†ç±»
- **MEMO_Bench**: å›¾åƒ-æ–‡æœ¬æƒ…æ„Ÿåˆ†ç±»
- **DFEW**: åŠ¨æ€é¢éƒ¨è¡¨æƒ…åˆ†ç±»

### å›å½’ä»»åŠ¡ (2ä¸ª)
- **AffectNet_VA**: æ•ˆä»·-å”¤é†’åº¦å›å½’
- **AffWild2_VA**: è¿ç»­æ•ˆä»·-å”¤é†’åº¦ä¼°è®¡

### å¤šæ¨¡æ€ä»»åŠ¡ (4ä¸ª)
- **CH_SIMS**: ä¸­æ–‡å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†æ
- **CH_SIMS_V2**: ä¸­æ–‡å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†æv2
- **CMU_MOSEI**: å¤šæ¨¡æ€æƒ…æ„Ÿå¼ºåº¦é¢„æµ‹
- **CMU_MOSI**: å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†æ

## ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
```bash
conda create -n qwen3-omni python=3.8
conda activate qwen3-omni
pip install -r requirements.txt
```

### ä¸»è¦ä¾èµ–
- torch >= 1.9.0
- torchvision
- transformers
- opencv-python
- pandas
- numpy
- pillow
- openai
- scikit-learn

### vLLMæœåŠ¡éƒ¨ç½²

å¯åŠ¨vLLMæœåŠ¡ï¼š
```bash
vllm serve /path/to/Qwen3-Omni-30B-A3B-Thinking \
    --host 0.0.0.0 \
    --port 8080 \
    --served-model-name qwen3-omni \
    --api-key g203 \
    --tensor-parallel-size 1 \
    --dtype bfloat16 \
    --max-model-len 32768 \
    --max-num-seqs 4 \
    --max-num-batched-tokens 32768 \
    --gpu-memory-utilization 0.95 \
    --enable-prefix-caching \
    --generation-config vllm \
    --trust-remote-code \
    --revision main
```

## å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•å•ä¸ªæ•°æ®é›†
```bash
# æµ‹è¯•DFEWæ•°æ®é›†ï¼Œæœ€å¤š3ä¸ªæ ·æœ¬
python test_datasets.py --dataset DFEW --max-samples 3

# æµ‹è¯•AffectNetåˆ†ç±»ä»»åŠ¡
python test_datasets.py --dataset AffectNet_Classifier --max-samples 5
```

### 2. è¯„ä¼°æ‰€æœ‰æ•°æ®é›†
```bash
# å¿«é€Ÿæµ‹è¯•æ‰€æœ‰æ•°æ®é›†ï¼Œæ¯ä¸ªæœ€å¤š2ä¸ªæ ·æœ¬
python test_datasets.py --max-samples 2

# å®Œæ•´è¯„ä¼°ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
python test_datasets.py
```

### 3. ä½¿ç”¨å®Œæ•´è¯„ä¼°å·¥å…·
```bash
# è¯„ä¼°æ‰€æœ‰æ•°æ®é›†ï¼Œç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
python evaluate_all_datasets.py --max-samples 10

# è¯„ä¼°æŒ‡å®šæ•°æ®é›†
python evaluate_all_datasets.py --dataset DFEW --max-samples 20

# ä½¿ç”¨è¿œç¨‹vLLMæœåŠ¡
python evaluate_all_datasets.py --base-url http://192.168.1.100:8080/v1 --max-samples 5
```

## è¾“å‡ºç»“æœ

### æµ‹è¯•æŠ¥å‘Š
- `dataset_test_report.md`: ç®€è¦æµ‹è¯•æŠ¥å‘Š
- `dataset_test_{dataset}_report.md`: å•ä¸ªæ•°æ®é›†æŠ¥å‘Š

### å®Œæ•´è¯„ä¼°æŠ¥å‘Š
- `evaluation_results/{timestamp}.json`: è¯¦ç»†è¯„ä¼°æ•°æ®
- `evaluation_results/{timestamp}.md`: ç»¼åˆè¯„ä¼°æŠ¥å‘Š

### æŠ¥å‘Šå†…å®¹
1. **æ€»ä½“ç»Ÿè®¡**: æˆåŠŸç‡ã€æ ·æœ¬æ•°é‡ç­‰
2. **æ•°æ®é›†åˆ†ç±»**: æŒ‰ä»»åŠ¡ç±»å‹åˆ†ç±»ç»Ÿè®¡
3. **è¯¦ç»†ç»“æœ**: æ¯ä¸ªæ•°æ®é›†çš„å…·ä½“æŒ‡æ ‡
4. **æ€§èƒ½æ±‡æ€»**: åˆ†ç±»ä»»åŠ¡å‡†ç¡®ç‡ã€å›å½’ä»»åŠ¡CCCç­‰
5. **é—®é¢˜åˆ†æ**: é”™è¯¯ç»Ÿè®¡å’Œæ”¹è¿›å»ºè®®

## é…ç½®æ–‡ä»¶

æ¯ä¸ªæ•°æ®é›†éƒ½æœ‰å¯¹åº”çš„é…ç½®æ–‡ä»¶åœ¨ `configs/` ç›®å½•ä¸‹ï¼š

- `affectnet.json`: AffectNetæ•°æ®é›†é…ç½®
- `dfew.json`: DFEWæ•°æ®é›†é…ç½®
- `meld.json`: MELDæ•°æ®é›†é…ç½®
- ç­‰ç­‰...

ä¸»è¦é…ç½®é¡¹ï¼š
```json
{
    "root": "/path/to/dataset",
    "max_samples": 100,
    "probe_samples": 5,
    "test_split": "test"
}
```

## ä»£ç ç»“æ„

```
mer_eval_kit/
â”œâ”€â”€ adapters/              # æ¨¡å‹é€‚é…å™¨
â”‚   â”œâ”€â”€ base.py           # åŸºç¡€é€‚é…å™¨æ¥å£
â”‚   â””â”€â”€ qwen_adapter_vllm.py  # Qwen3-Omni vLLMé€‚é…å™¨
â”œâ”€â”€ datasets/              # æ•°æ®é›†å¤„ç†
â”‚   â”œâ”€â”€ base.py           # åŸºç¡€æ•°æ®é›†ç±»
â”‚   â”œâ”€â”€ dfew.py           # DFEWæ•°æ®é›†
â”‚   â”œâ”€â”€ affectnet.py      # AffectNetæ•°æ®é›†
â”‚   â””â”€â”€ ...              # å…¶ä»–æ•°æ®é›†
â”œâ”€â”€ configs/              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ test_datasets.py      # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ evaluate_all_datasets.py  # å®Œæ•´è¯„ä¼°è„šæœ¬
â””â”€â”€ evaluation_results/   # è¾“å‡ºç»“æœ
```

## å…³é”®ç‰¹æ€§

### æ™ºèƒ½è§†é¢‘å¤„ç†
- è‡ªåŠ¨è§†é¢‘å¸§é‡‡æ ·ï¼ˆé»˜è®¤8å¸§ï¼‰
- æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼ï¼ˆMP4, AVI, MOVï¼‰
- å†…å­˜å‹å¥½çš„å¸§åŠ è½½ç­–ç•¥

### å¤šæ¨¡æ€æ”¯æŒ
- **çº¯æ–‡æœ¬**: æƒ…æ„Ÿææ€§åˆ†æ
- **çº¯å›¾åƒ**: è¡¨æƒ…åˆ†ç±»å’ŒVAä¼°è®¡
- **çº¯è§†é¢‘**: åŠ¨æ€æƒ…æ„Ÿåˆ†æ
- **å¤šæ¨¡æ€**: æ–‡æœ¬+å›¾åƒ+è§†é¢‘èåˆåˆ†æ

### é”™è¯¯å¤„ç†
- ç±»å‹å®‰å…¨çš„é¢„æµ‹ç»“æœè§£æ
- ä¼˜é›…çš„é™çº§å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **è§†é¢‘å¤„ç†**: 
   - ä½¿ç”¨SSDå­˜å‚¨è§†é¢‘æ–‡ä»¶
   - è€ƒè™‘è§†é¢‘é¢„å¤„ç†å’Œç¼“å­˜
   - è°ƒæ•´å¸§é‡‡æ ·æ•°é‡

2. **å†…å­˜ç®¡ç†**:
   - åˆ†æ‰¹å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†
   - è°ƒæ•´vLLMçš„`max-num-seqs`å‚æ•°
   - ç›‘æ§GPUå†…å­˜ä½¿ç”¨

3. **ç½‘ç»œä¼˜åŒ–**:
   - ä½¿ç”¨å±€åŸŸç½‘è¿æ¥vLLMæœåŠ¡
   - è°ƒæ•´vLLMçš„æ‰¹å¤„ç†å‚æ•°
   - è€ƒè™‘æ¨¡å‹å¹¶è¡Œ

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†"unsupported operand type(s)"é”™è¯¯ï¼Ÿ
A: è¿™æ˜¯ç±»å‹è½¬æ¢é—®é¢˜ï¼Œä¸»è¦åœ¨è§†é¢‘å¤„ç†æ—¶å‡ºç°ã€‚å¯ä»¥å°è¯•ï¼š
- æ£€æŸ¥æ•°æ®é›†é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„è®¾ç½®
- ç¡®ä¿è§†é¢‘æ–‡ä»¶æ ¼å¼æ­£ç¡®
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—å®šä½é—®é¢˜

### Q: å¦‚ä½•è°ƒæ•´è§†é¢‘å¸§æ•°ï¼Ÿ
A: åœ¨é€‚é…å™¨åˆå§‹åŒ–æ—¶è®¾ç½®ï¼š
```python
adapter = Adapter(base_url, model_name, max_frames=16)  # ä½¿ç”¨16å¸§
```

### Q: å¦‚ä½•æ·»åŠ æ–°æ•°æ®é›†ï¼Ÿ
A: 1. åœ¨`datasets/`ç›®å½•åˆ›å»ºæ–°çš„æ•°æ®é›†ç±»
2. ç»§æ‰¿`ClassificationDataset`æˆ–ç›¸åº”åŸºç±»
3. å®ç°å¿…è¦çš„æ–¹æ³•
4. åˆ›å»ºå¯¹åº”çš„é…ç½®æ–‡ä»¶

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå­¦æœ¯ç ”ç©¶å·¥å…·ï¼Œä¸»è¦ç”¨äºè®ºæ–‡å®éªŒå’Œæ¨¡å‹è¯„ä¼°ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·è¿›è¡Œå……åˆ†çš„æµ‹è¯•ã€‚
